{% extends "layout.html" %}

{% block head %}
    {{ super() }}
    <style type="text/css">
        .input-group {
            width: 600px;
            margin: 50px auto;
        }
        .form-group  {
            margin-bottom: 15px;
            background: #f7f7f7;
            box-shadow: 0px 2px 2px rgba(0, 0, 0, 0.3);
            padding: 30px;
            width: 600px;
            margin: 50px auto;
        }
        .form-control {
            min-height: 38px;
            border-radius: 2px;
        }
        .input {
            min-height: 38px;
            border-radius: 2px;
        }
        .message {
            text-align: center;
            color: red;
        }
    </style>
{% endblock %}

{% block heading %}
{% endblock %}

{% block body %}

<h2 align="center">WELCOME TO THE HOME PAGE</h2>
<h3>Helloo {{name}} !!</h3>
<p>Sucessfully Logged into the page</p>
<div class = "LogoutButton" align="right">
    <form action="/logout">
        <button class="btn btn-secondary btn-lg" type="submit">LOGOUT</button>
    </form>
</div>
<div class="input_div">
    <form id="searchform"> 
        <p class='message' >Please choose the Type of Search</p>
        <div class="form-group">
            <select name="searchType" class="form-control" id="Select1">
              <option>isbn</option>
              <option>title</option>
              <option>author</option>
            </select>
        </div>
        <div class="input-group">
            <input type="text" name="search" class="input" placeholder="Search">
            <button class="submit" type="submit">Search</button>
        </div>
    </form>
</div>
<div id='searchresults'></div>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
<script type="text/javascript">
$("#searchform").submit(function(e) {
    e.preventDefault(); 
    var url = "/api/search"
    var formData = jQuery('#searchform').serializeArray();
    responseobj = {}
    for(var i = 0; i< formData.length; i++) {
      console.log(formData)
      responseobj['query'] = formData[i]["value"]
    }
    console.log(formData);
    console.log(responseobj);
    $.ajax({
          type: "POST",
          url: url,
          data: JSON.stringify(responseobj),
          contentType: "application/json",
          success: function(data)
          {
            console.log(data["0"]);
            var htmltext = "<br><div class = 'container'> <div class = 'tableFixHead'>"+
    "<table class='table'>"+
    "<thead><tr><th> {{ 'Isbn' }}</th><th> {{ 'Title' }}</th><th> {{ 'Author' }}</th>"+
    "<th> {{ 'Year' }}</th></tr></thead><tbody>";
            for(var i = 0; i < data.length; i++) {
              htmltext = htmltext +"<tr>" + "<td>"+data[i]["isbn"] +"</td>"+ "<td>" + data[i]["title"] +"</td>"+
                            "<td>" + data[i]["author"] +"</td>"+ "<td>" + data[i]["year"] + "</tr>"
            }
            htmltext = htmltext + "</ul>"
            $("#searchresults").html(htmltext);
          }
        });
    });
</script>

{% endblock %}